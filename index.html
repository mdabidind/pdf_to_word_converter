<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDF → Word Converter (Browser Only)</title>
<style>
  body{font-family:Arial;display:flex;align-items:center;justify-content:center;height:100vh;background:#f3f6ff}
  .card{width:820px;background:white;padding:22px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.06)}
  .drop{border:3px dashed rgba(99,102,241,.16);padding:30px;border-radius:10px;text-align:center;cursor:pointer}
  .muted{color:#6b7280;font-size:13px}
  .btn{padding:8px 14px;border-radius:8px;border:none;background:#4f46e5;color:#fff;cursor:pointer}
</style>
</head>
<body>
  <div class="card">
    <h2>PDF → Word Converter (GitHub Pages)</h2>

    <div id="dropZone" class="drop">
      <p class="muted">Drag & drop PDF here or <button id="browseBtn" class="btn" type="button">Browse</button></p>
      <input id="fileElem" type="file" accept="application/pdf" style="display:none" />
      <div id="status" style="margin-top:10px;color:#333"></div>
    </div>

    <a id="downloadLink" class="btn" style="display:none;margin-top:10px;">Download Word File</a>
  </div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
<script>
let pyodideReady = false;

async function initPyodide() {
  const pyodide = await loadPyodide();
  await pyodide.loadPackage("micropip");
  await pyodide.runPythonAsync(`
    import micropip
    await micropip.install("pdf2docx")
  `);
  window.pyodide = pyodide;
  pyodideReady = true;
  document.getElementById("status").textContent = "Ready for conversion!";
}
initPyodide();

const dropZone = document.getElementById('dropZone');
const fileElem = document.getElementById('fileElem');
const browseBtn = document.getElementById('browseBtn');
const statusEl = document.getElementById('status');
const downloadLink = document.getElementById('downloadLink');

browseBtn.addEventListener('click', ()=> fileElem.click());
dropZone.addEventListener('dragover', e=> e.preventDefault());
dropZone.addEventListener('drop', e=>{
  e.preventDefault(); 
  if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]); 
});
fileElem.addEventListener('change', e=>{
  if(e.target.files.length) handleFile(e.target.files[0]); 
});

async function handleFile(file){
  if(!pyodideReady){ alert("Python not ready yet!"); return; }
  if(!file || file.type !== "application/pdf"){ alert("Please select a PDF file"); return; }
  
  statusEl.textContent = "Converting " + file.name + "... please wait";

  const arrayBuffer = await file.arrayBuffer();
  const uint8Array = new Uint8Array(arrayBuffer);
  pyodide.FS.writeFile("input.pdf", uint8Array);

  await pyodide.runPythonAsync(`
    from pdf2docx import Converter
    cv = Converter("input.pdf")
    cv.convert("output.docx", start=0, end=None)
    cv.close()
  `);

  const result = pyodide.FS.readFile("output.docx");
  const blob = new Blob([result], { type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
  const url = URL.createObjectURL(blob);

  downloadLink.href = url;
  downloadLink.download = file.name.replace(/\.pdf$/i, "") + ".docx";
  downloadLink.style.display = "inline-block";
  downloadLink.textContent = "Download " + downloadLink.download;

  statusEl.textContent = "Conversion finished!";
}
</script>
</body>
</html>
